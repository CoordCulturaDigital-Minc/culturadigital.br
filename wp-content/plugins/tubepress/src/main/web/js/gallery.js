var TubePressGallery=(function(h,g,p){var w="tubepress",l=w+".gallery.",e=w+".video.",d=w+".playerlocation.",j=d+"populate",c=d+"invoke",u=l+"load",x=l+"newthumbs",E=l+"pagechange",f=l+"changevideo",q=l+"nextvideo",k=l+"previousvideo",b=e+"start",r=e+"stop",v="urls",i="sys",n="js",F=p.Beacon,o=F.subscribe,A=F.publish,a=p.Lang.Utils,D=p.Environment,t=p.DomInjector,z="src/main/web/js",B=true,C=false,m=g.TubePressJsConfig,s=(function(){var V={},S="nvpMap",U="jsMap",L="page",G="currentVideoId",aa="playingNow",ab=a.parseIntOrZero,R="playerLocation",ae="embedded",Z=F.subscribe,Y=function(ao){return a.isDefined(V[ao])},ad=function(ao,aq,ap){return Y(ao)?V[ao][aq][ap]:null},ac=function(ao){return Y(ao)?V[ao][L]:undefined},Q=function(ao){return Y(ao)?V[ao][G]:undefined},K=function(ao){return ad(ao,U,"ajaxPagination")},T=function(ao){return ad(ao,U,"autoNext")},J=function(ao){return Y(ao)?V[ao][aa]:C},H=function(ao){return ad(ao,U,"fluidThumbs")},an=function(ao){return ad(ao,S,ae+"Height")},am=function(ao){return ad(ao,S,ae+"Width")},aj=function(ao){return ad(ao,U,"httpMethod")},M=function(ao){return V[ao][S]},af=function(ao){return ad(ao,S,R)},P=function(ao){return ad(ao,U,R+"JsUrl")},N=function(ao){return ad(ao,U,R+"ProducesHtml")},X=function(ao){return ad(ao,U,"sequence")},ak=function(ao){return"#"+w+"_gallery_"+ao+"_thumbnail_area"},ah=function(at,ar,au){var aq=a.getParameterByName(w+"_page"),ao=ab(aq),ap="ajaxPagination",av;V[ar]=au;V[ar][L]=ao===0?1:ao;V[ar][aa]=C;av=X(ar);if(av){V[ar][G]=av[0]}if(K(ar)){if(a.hasOwnNestedProperty(m,v,n,i,ap)){t.loadJs(m[v][n][i][ap])}else{t.loadJs(z+"/"+ap+".js")}}},W=function(ar,aq,ap){if(Y(aq)){var ao=ab(ap);V[aq][L]=ao===0?1:ao}},ag=function(ap){var ao;for(ao in V){if(V.hasOwnProperty(ao)){if(ap(ao)){return ao}}}return undefined},I=function(ap){var ao='[id^="'+ap+'"]',aq=function(at){var ar=h("#"+w+"_gallery_"+at);if(!ar.length){return false}return ar.find(ao).length>0};return ag(aq)},al=function(aq,ap,ao){var ar=I(ao);if(!ar){return}V[ar][J]=C},ai=function(aq,ap,ao){var ar=I(ao);if(!ar){return}V[ar][J]=B;V[ar][G]=ap},O=function(ap,ao,aq){if(Y(ao)){V[ao][G]=aq}};Z(u,ah);Z(E,W);Z(f,O);Z(r,al);Z(b,ai);return{isAjaxPagination:K,isAutoNext:T,isCurrentlyPlayingVideo:J,isFluidThumbs:H,isRegistered:Y,findGalleryContainingVideoDomId:I,getCurrentPageNumber:ac,getCurrentVideoId:Q,getEmbeddedHeight:an,getEmbeddedWidth:am,getHttpMethod:aj,getNvpMap:M,getPlayerLocationName:af,getPlayerLocationProducesHtml:N,getPlayerLocationJsUrl:P,getSequence:X,getThumbAreaSelector:ak}}()),y=(function(){var G=function(H,I){A(u,[H,I])};return{register:G}}());(function(){var J=Math.floor,I=function(M){return s.getThumbAreaSelector(M)},H=function(M){return h(I(M))},G=function(P){var N=H(P),M=N.find("img:first"),O=120;if(M.length===0){M=N.find("div."+w+"_thumb:first > div."+w+"_embed");if(M.length===0){return O}}O=M.attr("width");if(O){return O}return M.width()},K=function(R){H(R).css({width:"100%"});var P=I(R),T=G(R),N=h(P),S=N.width(),O=J(S/T),Q=J(S/O),M=h(P+" div."+w+"_thumb");N.css({width:"100%"});N.css({width:S});M.css({width:Q})},L=function(N,M){if(s.isFluidThumbs(M)){K(M)}};o(x+" "+u,L)}());(function(){var I=function(K){return K[3]},G=function(L){var K=L.lastIndexOf("_");return L.substring(16,K)},H=function(){var K=h(this).attr("rel").split("_"),L=I(K),M=G(h(this).attr("id"));A(f,[L,M])},J=function(L,K){h("#"+w+"_gallery_"+K+" a[id^='"+w+"_']").click(H)};o(x+" "+u,J)}());(function(){var G=function(K,I){var J=s.getPlayerLocationJsUrl(I);t.loadJs(J)},H=function(N,R,O){var K=s.getPlayerLocationName(R),Q=s.getEmbeddedHeight(R),J=s.getEmbeddedWidth(R),L=s.getNvpMap(R),P=function(U){var S=p.Lang.JsonParser.parse(U.responseText),V=S.title,T=S.html;A(j,[K,V,T,Q,J,O,R])},M={action:"playerHtml",tubepress_video:O},I;h.extend(M,L);A(c,[K,Q,J,O,R]);if(s.getPlayerLocationProducesHtml(R)){I=s.getHttpMethod(R);p.Ajax.Executor.get(I,D.getAjaxEndpointUrl(),M,P,"json")}};o(u,G);o(f,H)}());(function(){var G=function(I,J){var K=I.data("page");A(E,[J,K])},H=function(J,I){var K=function(){G(h(this),I);if(s.isAjaxPagination(I)){J.preventDefault();return C}return B};h("#"+w+"_gallery_"+I+" div.pagination a").click(K)};o(x+" "+u,H)}());(function(){var G=function(L,K){var N=s.getSequence(K),J=s.getCurrentVideoId(K),I=h.inArray(J.toString(),N),M=N?N.length-1:I;if(I===-1||I===M){return}A(f,[K,N[I+1]])},H=function(L,K){var M=s.getSequence(K),J=s.getCurrentVideoId(K),I=h.inArray(J.toString(),M);if(I===-1||I===0){return}A(f,[K,M[I-1]])};o(q,G);o(k,H)}());(function(){var H=p.Logger,G=function(N,M,L,J,K){var I=s.findGalleryContainingVideoDomId(L);if(!I){return}if(s.isAutoNext(I)&&s.getSequence(I)){if(H.on()){H.log("Auto-starting next for gallery "+I)}F.publish(q,[I])}};F.subscribe(r,G)}());p.AsyncUtil.processQueueCalls("tubePressGalleryRegistrar",y);return{Registry:s}}(jQuery,window,TubePress));