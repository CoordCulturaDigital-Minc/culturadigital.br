/*!
 * Copyright 2006 - 2014 TubePress LLC (http://tubepress.com).
 * This file is part of TubePress (http://tubepress.com).
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
var tubePressGalleryRegistrar;(function(h,g,p){var w="tubepress",l=w+".gallery.",e=w+".video.",d=w+".playerlocation.",j=d+"populate",c=d+"invoke",u=l+"load",x=l+"newthumbs",E=l+"pagechange",f=l+"changevideo",q=l+"nextvideo",k=l+"previousvideo",b=e+"start",r=e+"stop",v="urls",i="sys",n="js",F=p.Beacon,o=F.subscribe,A=F.publish,a=p.Lang.Utils,D=p.Environment,t=p.DomInjector,z="src/main/web/js",B=true,C=false,m=g.TubePressJsConfig,s=(function(){var af={},al="nvpMap",S="jsMap",ae="page",aa="currentVideoId",ai="playingNow",aj=a.parseIntOrZero,M="playerLocation",N="embedded",O=F.subscribe,H=function(aq){return a.isDefined(af[aq])},ac=function(aq,at,ar){return H(aq)?af[aq][at][ar]:null},K=function(aq){return H(aq)?af[aq][ae]:undefined},ao=function(aq){return H(aq)?af[aq][aa]:undefined},J=function(aq){return ac(aq,S,"ajaxPagination")},ah=function(aq){return ac(aq,S,"autoNext")},L=function(aq){return H(aq)?af[aq][ai]:C},ap=function(aq){return ac(aq,S,"fluidThumbs")},an=function(aq){return ac(aq,al,N+"Height")},R=function(aq){return ac(aq,al,N+"Width")},Y=function(aq){return ac(aq,S,"httpMethod")},W=function(aq){return af[aq][S]},P=function(aq){return af[aq][al]},V=function(aq){return ac(aq,al,M)},Z=function(aq){return ac(aq,S,M+"JsUrl")},am=function(aq){return ac(aq,S,M+"ProducesHtml")},ak=function(aq){return ac(aq,S,"sequence")},Q=function(aq){return"#"+w+"_gallery_"+aq+"_thumbnail_area"},T=function(av,au,aw){var at=a.getParameterByName(w+"_page"),aq=aj(at),ar="ajaxPagination",ax;af[au]=aw;af[au][ae]=aq===0?1:aq;af[au][ai]=C;ax=ak(au);if(ax){af[au][aa]=ax[0]}if(J(au)){if(a.hasOwnNestedProperty(m,v,n,i,ar)){t.loadJs(m[v][n][i][ar])}else{t.loadJs(z+"/"+ar+".js")}}},ag=function(au,at,ar){if(H(at)){var aq=aj(ar);af[at][ae]=aq===0?1:aq}},ab=function(ar){var aq;for(aq in af){if(af.hasOwnProperty(aq)){if(ar(aq)){return aq}}}return undefined},U=function(ar){var aq='[id^="'+ar+'"]',at=function(av){var au=h("#"+w+"_gallery_"+av);if(!au.length){return false}return au.find(aq).length>0};return ab(at)},X=function(at,ar,aq){var au=U(aq);if(!au){return}af[au][L]=C},G=function(at,ar,aq){var au=U(aq);if(!au){return}af[au][L]=B;af[au][aa]=ar},I=function(ar,aq,at){if(H(aq)){af[aq][aa]=at}},ad=function(){var aq=[],ar;for(ar in af){aq.push(ar)}return aq};O(u,T);O(E,ag);O(f,I);O(r,X);O(b,G);return{isAjaxPagination:J,isAutoNext:ah,isCurrentlyPlayingVideo:L,isFluidThumbs:ap,isRegistered:H,findAllGalleryIds:ad,findGalleryContainingVideoDomId:U,getCurrentPageNumber:K,getCurrentVideoId:ao,getEmbeddedHeight:an,getEmbeddedWidth:R,getHttpMethod:Y,getJsMap:W,getNvpMap:P,getPlayerLocationName:V,getPlayerLocationProducesHtml:am,getPlayerLocationJsUrl:Z,getSequence:ak,getThumbAreaSelector:Q}}()),y=(function(){var G=function(H,I){A(u,[H,I])};return{register:G}}());(function(){var J=Math.floor,I=function(N){return s.getThumbAreaSelector(N)},H=function(N){return h(I(N))},G=function(Q){var O=H(Q),N=O.find("img:first"),P=120;if(N.length===0){N=O.find("div."+w+"_thumb:first > div."+w+"_embed");if(N.length===0){return P}}P=N.attr("width");if(P){return P}return N.width()},K=function(T){H(T).css({width:"100%"});var S=I(T),U=G(T),P=h(S),R=P.width(),Q=J(R/U),O=J(R/Q),N=h(S+" div."+w+"_thumb");P.css({width:"100%"});P.css({width:R});N.css({width:O});P.data("fluid_thumbs_applied",true);F.publish(l+"fluidThumbs",[T,O])},M=function(O,N){if(s.isFluidThumbs(N)){K(N)}},L=function(Q){var O=s.findAllGalleryIds(),N=0,P=O.length;for(N;N<P;N+=1){M(Q,O[N])}};o(x+" "+u,M);o(w+".window.resize",L)}());(function(){var I=function(K){return K[3]},G=function(L){var K=L.lastIndexOf("_");return L.substring(16,K)},H=function(){var K=h(this).attr("rel").split("_"),L=I(K),M=G(h(this).attr("id"));A(f,[L,M])},J=function(L,K){h("#"+w+"_gallery_"+K+" a[id^='"+w+"_']").click(H)};o(x+" "+u,J)}());(function(){var G=function(K,I){var J=s.getPlayerLocationJsUrl(I);t.loadJs(J)},H=function(N,R,O){var K=s.getPlayerLocationName(R),Q=s.getEmbeddedHeight(R),J=s.getEmbeddedWidth(R),L=s.getNvpMap(R),P=function(U){var S=p.Lang.JsonParser.parse(U.responseText),V=S.title,T=S.html;A(j,[K,V,T,Q,J,O,R])},M={action:"playerHtml",tubepress_video:O},I;h.extend(M,L);A(c,[K,Q,J,O,R]);if(s.getPlayerLocationProducesHtml(R)){I=s.getHttpMethod(R);p.Ajax.Executor.get(I,D.getAjaxEndpointUrl(),M,P,"json")}};o(u,G);o(f,H)}());(function(){var G=function(I,J){var K=I.data("page");A(E,[J,K])},H=function(J,I){var K=function(){G(h(this),I);if(s.isAjaxPagination(I)){J.preventDefault();return C}return B};h("#"+w+"_gallery_"+I+" div.pagination a").click(K)};o(x+" "+u,H)}());(function(){var G=function(L,K){var N=s.getSequence(K),J=s.getCurrentVideoId(K),I=h.inArray(J.toString(),N),M=N?N.length-1:I;if(I===-1||I===M){return}A(f,[K,N[I+1]])},H=function(L,K){var M=s.getSequence(K),J=s.getCurrentVideoId(K),I=h.inArray(J.toString(),M);if(I===-1||I===0){return}A(f,[K,M[I-1]])};o(q,G);o(k,H)}());(function(){var G=function(J,I){var H=s.findGalleryContainingVideoDomId(I.domId);if(!H){return}if(s.isAutoNext(H)&&s.getSequence(H)){F.publish(q,[H])}};F.subscribe(r,G)}());p.AsyncUtil.processQueueCalls("tubePressGalleryRegistrar",y);p.Gallery={Registry:s};p.Beacon.publish(w+".js.sys.gallery")}(jQuery,window,TubePress));