(function(c){c.fn.extend({st_autocomplete:function(a,b){var n="string"==typeof a;b=c.extend({},c.Autocompleter.defaults,{url:n?a:null,data:n?null:a,delay:n?c.Autocompleter.defaults.delay:10,max:b&&!b.scroll?10:150,noRecord:"No Records."},b);b.highlight=b.highlight||function(a){return a};b.formatMatch=b.formatMatch||b.formatItem;return this.each(function(){new c.Autocompleter(this,b)})},result:function(a){return this.bind("result",a)},search:function(a){return this.trigger("search",[a])},flushCache:function(){return this.trigger("flushCache")},
setOptions:function(a){return this.trigger("setOptions",[a])},unautocomplete:function(){return this.trigger("unautocomplete")}});c.Autocompleter=function(a,b){function n(){var x=l.selected();if(!x)return!1;var e=x.result;s=e;if(b.multiple){var d=m(g.val());if(1<d.length){var f=b.multipleSeparator.length,r=c(a).selection().start,j,h=0;c.each(d,function(a,b){h+=b.length;if(r<=h)return j=a,!1;h+=f});d[j]=e;e=d.join(b.multipleSeparator)}e+=b.multipleSeparator}g.val(e);k();g.trigger("result",[x.data,x.value]);
return!0}function h(a,c){if(q==p.DEL)l.hide();else{var f=g.val();if(c||f!=s)s=f,f=j(f),f.length>=b.minChars?(g.addClass(b.loadingClass),b.matchCase||(f=f.toLowerCase()),d(f,e,k)):(g.removeClass(b.loadingClass),l.hide())}}function m(a){return!a?[""]:!b.multiple?[c.trim(a)]:c.map(a.split(b.multipleSeparator),function(b){return c.trim(a).length?c.trim(b):null})}function j(e){if(!b.multiple)return e;var d=m(e);if(1==d.length)return d[0];d=c(a).selection().start;d=d==e.length?m(e):m(e.replace(e.substring(d),
""));return d[d.length-1]}function k(){l.visible();l.hide();clearTimeout(f);g.removeClass(b.loadingClass);b.mustMatch&&g.search(function(a){a||(b.multiple?(a=m(g.val()).slice(0,-1),g.val(a.join(b.multipleSeparator)+(a.length?b.multipleSeparator:""))):(g.val(""),g.trigger("result",null)))})}function e(e,d){if(d&&d.length&&t){g.removeClass(b.loadingClass);l.display(d,e);var f=d[0].value;b.autoFill&&(j(g.val()).toLowerCase()==e.toLowerCase()&&q!=p.BACKSPACE)&&(g.val(g.val()+f.substring(j(s).length)),
c(a).selection(s.length,s.length+f.length));l.show()}else k()}function d(e,d,g){b.matchCase||(e=e.toLowerCase());var f=v.load(e);if(f)f.length?d(e,f):(g=b.parse&&b.parse(b.noRecord)||r(b.noRecord),d(e,g));else if("string"==typeof b.url&&0<b.url.length){var s={timestamp:+new Date};c.each(b.extraParams,function(a,b){s[a]="function"==typeof b?b():b});c.ajax({mode:"abort",port:"autocomplete"+a.name,dataType:b.dataType,url:b.url,data:c.extend({q:j(e),limit:b.max},s),success:function(a){a=b.parse&&b.parse(a)||
r(a);v.add(e,a);d(e,a)}})}else l.emptyList(),null!=w?w():g(e)}function r(a){var e=[];a=a.split("\n");for(var d=0;d<a.length;d++){var g=c.trim(a[d]);g&&(g=g.split("|"),e[e.length]={data:g,value:g[0],result:b.formatResult&&b.formatResult(g,g[0])||g[0]})}return e}var p={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},w=null;null!=b.failure&&"function"==typeof b.failure&&(w=b.failure);var g=c(a).attr("autocomplete","off").addClass(b.inputClass),f,s="",v=c.Autocompleter.Cache(b),
t=0,q,u={mouseDownOnSelect:!1},l=c.Autocompleter.Select(b,a,n,u),y;-1!=navigator.userAgent.indexOf("Opera")&&c(a.form).bind("submit.autocomplete",function(){if(y)return y=!1});g.bind((-1!=navigator.userAgent.indexOf("Opera")&&!1 in window?"keypress":"keydown")+".autocomplete",function(a){t=1;q=a.keyCode;switch(a.keyCode){case p.UP:l.visible()?(a.preventDefault(),l.prev()):h(0,!0);break;case p.DOWN:l.visible()?(a.preventDefault(),l.next()):h(0,!0);break;case p.PAGEUP:l.visible()?(a.preventDefault(),
l.pageUp()):h(0,!0);break;case p.PAGEDOWN:l.visible()?(a.preventDefault(),l.pageDown()):h(0,!0);break;case b.multiple&&","==c.trim(b.multipleSeparator)&&p.COMMA:case p.TAB:case p.RETURN:if(n())return a.preventDefault(),y=!0,!1;break;case p.ESC:l.hide();break;default:clearTimeout(f),f=setTimeout(h,b.delay)}}).focus(function(){t++}).blur(function(){t=0;u.mouseDownOnSelect||(clearTimeout(f),f=setTimeout(k,200))}).click(function(){b.clickFire?l.visible()||h(0,!0):1<t++&&!l.visible()&&h(0,!0)}).bind("search",
function(){function a(e,d){var c;if(d&&d.length)for(var f=0;f<d.length;f++)if(d[f].result.toLowerCase()==e.toLowerCase()){c=d[f];break}"function"==typeof b?b(c):g.trigger("result",c&&[c.data,c.value])}var b=1<arguments.length?arguments[1]:null;c.each(m(g.val()),function(b,e){d(e,a,a)})}).bind("flushCache",function(){v.flush()}).bind("setOptions",function(a,e){c.extend(!0,b,e);"data"in e&&v.populate()}).bind("unautocomplete",function(){l.unbind();g.unbind();c(a.form).unbind(".autocomplete")})};c.Autocompleter.defaults=
{inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:100,max:1E3,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(a){return a[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:" ",inputFocus:!0,clickFire:!1,highlight:function(a,b){return a.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),
"<strong>$1</strong>")},scroll:!0,scrollHeight:180,scrollJumpPosition:!0};c.Autocompleter.Cache=function(a){function b(b,d){a.matchCase||(b=b.toLowerCase());var c=b.indexOf(d);"word"==a.matchContains&&(c=b.toLowerCase().search("\\b"+d.toLowerCase()));return-1==c?!1:0==c||a.matchContains}function n(b,d){k>a.cacheLength&&m();j[b]||k++;j[b]=d}function h(){if(!a.data)return!1;var b={},d=0;a.url||(a.cacheLength=1);b[""]=[];for(var h=0,k=a.data.length;h<k;h++){var j=a.data[h],j="string"==typeof j?[j]:j,
g=a.formatMatch(j,h+1,a.data.length);if(!("undefined"===typeof g||!1===g)){var f=g.charAt(0).toLowerCase();b[f]||(b[f]=[]);j={value:g,data:j,result:a.formatResult&&a.formatResult(j)||g};b[f].push(j);d++<a.max&&b[""].push(j)}}c.each(b,function(b,d){a.cacheLength++;n(b,d)})}function m(){j={};k=0}var j={},k=0;setTimeout(h,25);return{flush:m,add:n,populate:h,load:function(e){if(!a.cacheLength||!k)return null;if(!a.url&&a.matchContains){var d=[],h;for(h in j)if(0<h.length){var n=j[h];c.each(n,function(a,
c){b(c.value,e)&&d.push(c)})}return d}if(j[e])return j[e];if(a.matchSubset)for(h=e.length-1;h>=a.minChars;h--)if(n=j[e.substr(0,h)])return d=[],c.each(n,function(a,c){b(c.value,e)&&(d[d.length]=c)}),d;return null}}};c.Autocompleter.Select=function(a,b,n,h){function m(a){for(a=a.target;a&&"LI"!=a.tagName;)a=a.parentNode;return!a?[]:a}function j(b){e.slice(d,d+1).removeClass(k.ACTIVE);if(a.scrollJumpPosition||!a.scrollJumpPosition&&!(0>b&&0==d||0<b&&d==e.size()-1))d+=b,0>d?d=e.size()-1:d>=e.size()&&
(d=0);b=e.slice(d,d+1).addClass(k.ACTIVE);if(a.scroll){var c=0;e.slice(0,d).each(function(){c+=this.offsetHeight});c+b[0].offsetHeight-f.scrollTop()>f[0].clientHeight?f.scrollTop(c+b[0].offsetHeight-f.innerHeight()):c<f.scrollTop()&&f.scrollTop(c)}}var k={ACTIVE:"ac_over"},e,d=-1,r,p="",w=!0,g,f;return{display:function(j,v){w&&(g=c("<div/>").hide().addClass(a.resultsClass).css("position","absolute").appendTo(document.body).hover(function(){c(this).is(":visible")&&b.focus();h.mouseDownOnSelect=!1}),
f=c("<ul/>").appendTo(g).mouseover(function(a){m(a).nodeName&&"LI"==m(a).nodeName.toUpperCase()&&(d=c("li",f).removeClass(k.ACTIVE).index(m(a)),c(m(a)).addClass(k.ACTIVE))}).click(function(d){c(m(d)).addClass(k.ACTIVE);n();a.inputFocus&&b.focus();return!1}).mousedown(function(){h.mouseDownOnSelect=!0}).mouseup(function(){h.mouseDownOnSelect=!1}),0<a.width&&g.css("width",a.width),w=!1);r=j;p=v;f.empty();for(var t=a.max&&a.max<r.length?a.max:r.length,q=0;q<t;q++)if(r[q]){var u=a.formatItem(r[q].data,
q+1,t,r[q].value,p);!1!==u&&(u=c("<li/>").html(a.highlight(u,p)).addClass(0==q%2?"ac_even":"ac_odd").appendTo(f)[0],c.data(u,"ac_data",r[q]))}e=f.find("li");a.selectFirst&&(e.slice(0,1).addClass(k.ACTIVE),d=0);c.fn.bgiframe&&f.bgiframe()},next:function(){j(1)},prev:function(){j(-1)},pageUp:function(){0!=d&&0>d-8?j(-d):j(-8)},pageDown:function(){d!=e.size()-1&&d+8>e.size()?j(e.size()-1-d):j(8)},hide:function(){g&&g.hide();e&&e.removeClass(k.ACTIVE);d=-1},visible:function(){return g&&g.is(":visible")},
current:function(){return this.visible()&&(e.filter("."+k.ACTIVE)[0]||a.selectFirst&&e[0])},show:function(){var d=c(b).offset();g.css({width:"string"==typeof a.width||0<a.width?a.width:c(b).width(),top:d.top+b.offsetHeight,left:d.left}).show();if(a.scroll&&(f.scrollTop(0),f.css({maxHeight:a.scrollHeight,overflow:"auto"}),-1!=navigator.userAgent.indexOf("MSIE")&&"undefined"===typeof document.body.style.maxHeight)){var h=0;e.each(function(){h+=this.offsetHeight});d=h>a.scrollHeight;f.css("height",d?
a.scrollHeight:h);d||e.width(f.width()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right")))}},selected:function(){var a=e&&e.filter("."+k.ACTIVE).removeClass(k.ACTIVE);return a&&a.length&&c.data(a[0],"ac_data")},emptyList:function(){f&&f.empty()},unbind:function(){g&&g.remove()}}};c.fn.selection=function(a,b){if(void 0!==a)return this.each(function(){if(this.createTextRange){var c=this.createTextRange();void 0===b||a==b?c.move("character",a):(c.collapse(!0),c.moveStart("character",a),
c.moveEnd("character",b));c.select()}else this.setSelectionRange?this.setSelectionRange(a,b):this.selectionStart&&(this.selectionStart=a,this.selectionEnd=b)});var c=this[0];if(c.createTextRange){var h=document.selection.createRange(),m=c.value,j=h.text.length;h.text="<->";h=c.value.indexOf("<->");c.value=m;this.selection(h,h+j);return{start:h,end:h+j}}if(void 0!==c.selectionStart)return{start:c.selectionStart,end:c.selectionEnd}}})(jQuery);
